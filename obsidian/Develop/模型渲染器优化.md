---
theme: seriph
background: https://zhongxuyang.github.io/blog/assets/DSCF3785.714143b6.jpg
class: text-center
highlighter: shiki
lineNumbers: false
info: |
  ## Slidev Starter Template
  Presentation slides for developers.

  Learn more at [Sli.dev](https://sli.dev)
drawings:
  persist: false
transition: slide-left
title: æ¨¡å‹æ¸²æŸ“å™¨ä¼˜åŒ–
fonts:
  sans: Noto Serif SC
  serif: Robot Slab
  mono: Fira Code
---


<style>
@keyframes hue {
  0% {
    -webkit-filter: hue-rotate(0deg);
    filter: hue-rotate(0deg);
  }

  to {
    -webkit-filter: hue-rotate(-1turn);
    filter: hue-rotate(-1turn);
  }
}

h1, h2, h3 {
  background-color: #2B90B6;
  background-image: linear-gradient(90deg, #01916d 10%, #018463 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
  text-shadow: 0px 0px 30px #018463;
  font-weight: bold !important;
  /* animation: hue 5s linear infinite alternate; */
}
.smaller{
  font-size: 0.8em;
}
.remark {
  font-size: 0.8em;
  opacity: 0.65;
}
.center{
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
}
</style>

# **æ¨¡å‹æ¸²æŸ“å™¨ä¼˜åŒ–**

#### æ¨ä¸­æ—­

<p class="remark">

[Preview](http://localhost:6006/?path=/story/example-erg--base)

</p>

<!--
å¤§å®¶å¥½ï¼Œä»Šå¤©ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹æ¨¡å‹æ¸²æŸ“å™¨çš„ä¼˜åŒ–éƒ½åšäº†å“ªäº›å·¥ä½œã€‚

é¦–å…ˆæ¥çœ‹ä¸€ä¸‹æ¸²æŸ“å™¨çš„åŠŸèƒ½éƒ½æœ‰å“ªäº›ã€‚
-->

---

## ä¸»é¢˜

1. âš™ï¸ å·¥å…·å˜åŒ–

1. ğŸ¨ è®¾è®¡ç¼ºé™·
    - ğŸ–Œï¸ ç”»å¸ƒ
    - ğŸ”„ æ•°æ®æ›´æ–°æœºåˆ¶
    - ğŸ“¡ äº‹ä»¶ä¸­å¿ƒæœºåˆ¶

3. ğŸ› ï¸ åŠŸèƒ½å®ç°
    - ğŸ–¼ï¸ Canvas
    - ğŸ§© Plugins
    - ğŸ“š Typedoc

<!--
è¿™æ˜¯ä»Šå¤©è®²çš„ä¸»é¢˜èŒƒå›´ã€‚
-->

---
layout: image-right
image: https://zhongxuyang.github.io/blog/assets/96580014.1cb84cc5.jpg
---

## 1 **å·¥å…·å˜åŒ–**


---

### å·¥å…·å˜åŒ–


|     | Before | After |
| --- | --- | --- |
| è¯­è¨€ | js | ts |
| æ„å»ºå·¥å…· | webpack | vite |
| æ¨¡ç‰ˆç¤ºä¾‹ | webpackã€html | storybookã€vue |
| æ–‡æ¡£ç”Ÿæˆ | æ‰‹å†™ | typedoc |

<!--
é¦–å…ˆç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹å·¥å…·ä¸Šçš„æ”¹å˜ã€‚
-->

---
layout: image-right
image: https://zhongxuyang.github.io/blog/assets/DSCF3104.1b8c9731.jpg
---

## 2 **è®¾è®¡ç¼ºé™·**

<!--
æ¥ä¸‹æ¥æ˜¯å…³äºä¼˜åŒ–å‰åçš„å¯¹æ¯”ã€‚
-->

---

### ç”»å¸ƒ - Canvas

|     | Before | After |
| --- | --- | --- |
| å†™æ³• | ä¸æ¸²æŸ“å™¨ä»£ç æºæ‚åœ¨ä¸€èµ· | Canvasç±» |
| ç•Œé™ | æœ‰èµ·å§‹è¾¹ç•Œ | æ— è¾¹ç•Œ |
| èƒŒæ™¯ | å›ºå®š | å¯æ‹“å±•ã€å¯è§†åŒºæ¸²æŸ“ |
| æ»šåŠ¨ | ä¾æ‰˜æ»šåŠ¨æ¡ | è‡ªæ‰˜ç®¡ |
| å›¾å±‚ | ç¼“å­˜å±‚ã€ä¸»è§†å›¾å±‚ | ç¼“å­˜å±‚ã€ä¸»è§†å›¾å±‚ã€[äº‹ä»¶å±‚](https://g6.antv.antgroup.com/zh/examples/performance/perf/#eva)ã€æ‹“å±•å±‚ |
<!-- | æ›´å¤š | - | EventCenterã€viewToã€export | -->

<!--
é¦–å…ˆæ˜¯å…³äºCanvasç±»çš„ä¼˜åŒ–ã€‚

æŠŠç”»å¸ƒçš„ç›¸å…³åŠŸèƒ½ä»æ¸²æŸ“å™¨æŠ½ç¦»å‡ºæ¥çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä»£ç å˜å¾—æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ–¹ä¾¿å¤šå®ä¾‹è°ƒç”¨äº†ã€‚ä¾‹å¦‚ç°åœ¨åº”ç”¨åœ¨æ¨¡å‹å’Œè¡€ç¼˜ä¸¤ä¸ªæ¸²æŸ“å™¨ä¸­ã€‚


> åˆ†å±‚æ¸²æŸ“

æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»ä¸‹åˆ†å±‚æ¸²æŸ“ï¼š
ç¼“å­˜å±‚å’Œä¸»è§†å›¾å±‚å¯èƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œé‚£äº‹ä»¶å±‚å’Œæ‹“å±•å±‚æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

äº‹ä»¶è§†å›¾å±‚çš„ä½œç”¨ï¼šä¸»è¦æ˜¯å‚è€ƒantvçš„è®¾è®¡ã€‚åœ¨æ•°æ®é‡å·¨å¤§çš„åœºæ™¯ä¸­ï¼Œäº‹ä»¶é¢‘ç¹è§¦å‘éœ€è¦ç»˜åˆ¶å…¨é‡æ•°æ®æ€§èƒ½æ¶ˆè€—æ˜¯å·¨å¤§çš„ï¼Œè¿™æ—¶åªç»˜åˆ¶éƒ¨åˆ†å†…å®¹ï¼Œå…¶ä½™ä¸»è§†å›¾å±‚ä½œä¸ºèƒŒæ™¯å›¾çš„ä½œç”¨ï¼Œä¾‹å¦‚ Antv ä¸­é¼ æ ‡ç§»åŠ¨åªåœ¨äº‹ä»¶å±‚ç»˜åˆ¶äº†hoverå®ä½“ï¼Œå…¨é‡æ•°æ®åœ¨äº‹ä»¶å±‚ä¸‹æ–¹ç›¸å½“äºèƒŒæ™¯å›¾ï¼Œå‚ç…§ï¼š[antv](https://g6.antv.antgroup.com/zh/examples/performance/perf/#eva)
-->

---

### Canvaså±‚çº§å…³ç³»


<div class="layer-box">
  <div>ç¼“å­˜å±‚</div>
  <div>ä¸»è§†å›¾</div>
  <div>äº‹ä»¶å±‚</div>
  <div>æ‹“å±•å±‚</div>
</div>

<style>
@keyframes closeTo{
  0% {
    top: -60px;
    left: -80px;
  }
  100% {
    top: -20px;
    left: 0px;
  }
}
@keyframes rotate{
  0% {
    -webkit-filter: hue-rotate(0deg);
    filter: hue-rotate(0deg);
  }

  to {
    -webkit-filter: hue-rotate(-1turn);
    filter: hue-rotate(-1turn);
  }
}
.layer-box{
  position: relative;
  width: 400px;
  height: 250px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  perspective: 800px;
}
.layer-box div{
  position: absolute;
  padding: 10px;
  width: 100%;
  height: 100%;
  border: 1px solid #f68084;
  background: rgba(122, 122, 122, 0.3);
  transform: rotateY(45deg);
  border-radius: 5px;
}
.layer-box div:nth-of-type(1){
  top: -60px;
  left: -80px;
  animation: closeTo 3s infinite alternate;
}
.layer-box div:nth-of-type(2){
  top: -20px;
  left: 0px;
  background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
.layer-box div:nth-of-type(3){
  top: 20px;
  left: 80px;
  animation: rotate 3s infinite alternate;
  background-image: linear-gradient(-225deg, #473B7B80 0%, #3584A780 51%, #30D2BE80 100%);
}
.layer-box div:nth-of-type(4){
  top: 60px;
  left: 160px;
}
</style>

<!--
è¿™æ˜¯åˆ†å±‚çš„å…³ç³»ç¤ºæ„å›¾ã€‚

// å…ˆä»‹ç»ä¸‹å„åˆ†å±‚çš„ä½œç”¨ //


éœ€è¦æ³¨æ„çš„æ˜¯å•çº¯ä¾é åˆ†å±‚æ¸²æŸ“ä¾ç„¶ä¸èƒ½è§£å†³æ‰€æœ‰æ¸²æŸ“ä¸Šçš„æ€§èƒ½é—®é¢˜ï¼š

åœ¨ä¸€äº›æƒ…å†µä¸‹åˆ†å±‚æ¸²æŸ“æ˜¯ä¸èƒ½é€‚ç”¨çš„ï¼Œä¾‹å¦‚ï¼šåœ¨è¿™äº›å›¾å±‚ä¹‹é—´æœ‰ç€å›ºå®šçš„ä¸Šä¸‹å±‚çº§ï¼Œå› æ­¤å¦‚æœä¸¤/å¤šä¸ªå…ƒç´ ä¹‹é—´äº¤äº’å±‚å ï¼Œè¿™æ—¶å€™åˆ†å±‚å°±æ²¡åŠæ³•æ»¡è¶³äº†ï¼ˆè¿™æ—¶å€™éœ€è¦çš„æ˜¯å…ƒç´ åˆ†ç»„ä»¥åŠå±€éƒ¨æ¸²æŸ“ï¼Œå±€éƒ¨æ¸²æŸ“å¾ˆå¤æ‚ã€‚ã€‚ã€‚éœ€è¦è®¡ç®—æ‰€æœ‰ç›¸é‚»å…ƒç´ çš„åŒ…å›´ç›’è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œç¡®å®šæœ€å°çš„é‡ç»˜èŒƒå›´ï¼ŒåŒæ—¶éœ€è¦æ³¨æ„ä¸Šä¸‹çš„å±‚çº§å…³ç³»çš„å½±å“ï¼‰ã€‚
-->

---

### æ•°æ®æ›´æ–°æœºåˆ¶ - DataHandler

<br/>

<div style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 10px;">
  <div>
    <i>Before</i>
    <p>
      æ¸²æŸ“å™¨ç›´æ¥ä¿®æ”¹å¤–éƒ¨æ•°æ®ï¼Œå¤–éƒ¨é€šè¿‡ watch åŸå§‹æ•°æ®çš„å˜åŒ–è§¦å‘æœåŠ¡ç«¯ä¿å­˜ç­‰æ“ä½œã€‚
    </p>
  </div>

  <div>
    <i>After</i>
    <p>
      æ¸²æŸ“å™¨è‡ªèº«ä¸ä¿®æ”¹åŸå§‹æ•°æ®ï¼Œä¸€åˆ‡æ›´æ–°é€šè¿‡ EventCenter é€šçŸ¥å¤–éƒ¨æ“ä½œã€‚
    </p>
    <p class="remark">
      è¿™ç§æ–¹å¼è™½ç„¶é€»è¾‘æ›´æ¸…æ™°äº†ï¼Œä½†ä¼šé€ æˆå¤–éƒ¨éœ€è¦æŒ‚è½½å¤§é‡çš„ç›‘å¬ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤ªæ˜“ç”¨çš„ã€‚
      å› æ­¤æ¸²æŸ“å™¨æä¾›äº† DataHandler ç±»ç”¨äºæ¥ç®¡åŸå§‹æ•°æ®ï¼Œé¿å…äº†åœ¨ä½¿ç”¨æ—¶éœ€è¦æŒ‚è½½å¤§é‡çš„ç›‘å¬åŠæ•°æ®æ›´æ–°çš„ä»£ç çš„ç¹çã€‚
    </p>
  </div>
</div>

<!--
è¿™æ¬¡æ˜¯è¿™æ¬¡é‡å†™æ¯”è¾ƒé‡è¦çš„æ”¹åŠ¨ä¹‹ä¸€ï¼Œä¿®æ”¹äº†æ•°æ®çš„æ›´æ–°æœºåˆ¶ã€‚

åŸæœ‰çš„ä»£ç ä¸­ï¼Œå½“é¡µé¢å‘ç”Ÿäº¤äº’æ—¶ï¼Œæ¸²æŸ“å™¨ä¼šç›´æ¥ä¿®æ”¹ä¼ é€’è¿›æ¥çš„æ•°æ®ï¼Œè¿™å¯¼è‡´å¯¹äºä¿®æ”¹åŸå§‹æ•°æ®çš„ä»£ç æ•£è½åœ¨ç¨‹åºçš„å„ä¸ªè§’è½ï¼Œé¦–å…ˆè¿™ç§å†™æ³•æ˜¯å¾ˆæ··ä¹±çš„ã€‚

å…¶æ¬¡å¤–éƒ¨æƒ³è¦è·çŸ¥è¿™ç§ä¿®æ”¹ï¼Œåªèƒ½å¤Ÿç›‘å¬åŸå§‹æ•°æ®ï¼Œè€Œwatchåˆåªèƒ½å¤Ÿæ„ŸçŸ¥åˆ°æ•°æ®çš„å˜åŒ–ï¼Œå´ä¸çŸ¥é“æ˜¯å…·ä½“çš„å“ªä¸€ä¸ªå±æ€§å‘ç”Ÿäº†æ€æ ·çš„å˜åŒ–ã€‚ï¼ˆå¦‚æœæƒ³è¦å®šä½åˆ°ä¿®æ”¹æ•°æ®åªèƒ½å¤Ÿdiffï¼Œè€Œä¿®æ”¹åˆæ˜¯æ¯æ—¶æ¯åˆ»éƒ½åœ¨å‘ç”Ÿçš„ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯å¾ˆå¥½çš„è§£å†³åŠæ³•ã€‚ï¼‰

åœ¨æ„Ÿå—äº†ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ç—›ç‚¹åï¼Œè¿™æ¬¡å¼•å…¥äº† äº‹ä»¶ä¸­å¿ƒ - `EventCenter`ç”¨äºé€šçŸ¥å¤–éƒ¨æ›´æ–°æ•°æ®ï¼ˆä¸‹ä¸€èŠ‚ä¼šè®²åˆ°`EventCenter`ï¼‰ã€‚

ä¸»è¦æ€è·¯å°±æ˜¯æ¸²æŸ“å™¨è‡ªèº«ä¸ä¿®æ”¹åŸå§‹æ•°æ®ï¼Œä¸€åˆ‡æ›´æ–°é€šè¿‡ EventCenter é€šçŸ¥å¤–éƒ¨æ“ä½œã€‚

ä½†è¿™ç§æ–¹å¼è™½ç„¶é€»è¾‘æ›´æ¸…æ™°äº†ï¼Œä½†ä¼šé€ æˆåœ¨ä½¿ç”¨æ—¶å¤–éƒ¨éœ€è¦æŒ‚è½½å¤§é‡çš„ç›‘å¬ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤ªæ˜“ç”¨çš„ã€‚

å› æ­¤æ¸²æŸ“å™¨æä¾›äº†å¯é€‰çš„ DataHandler ç±»ç”¨äºæ¥ç®¡åŸå§‹æ•°æ®ï¼Œé¿å…äº†åœ¨ä½¿ç”¨æ—¶éœ€è¦æŒ‚è½½å¤§é‡çš„ç›‘å¬åŠæ•°æ®æ›´æ–°çš„ä»£ç çš„ç¹çã€‚
-->

---

### äº‹ä»¶ä¸­å¿ƒ - EventCenter

<br/>

<div style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 10px;">
  <div>
    <i>Before</i>
    
```ts {5-9,11}
const renderer = new Graph()

renderer.load({
  // ...
  externalFn: {
    addNode () {},
    delNode () {},
    addLine () {},
    delLine () {},
    // ...
  },
})
```
  </div>

  <div>
    <i>After</i>

```ts {4-8}
const renderer = new Graph({
  // ...
})

renderer.on(NodeEvent.New, (info) => {})
renderer.on(NodeEvent.Delete, (info) => {})
renderer.on(LineEvent.New, (info) => {})
renderer.on(NodeEvent.Delete, (info) => {})
// ...
```
  </div>
</div>

<!--
æ¥ä¸‹æ¥å¯¹äºäº‹ä»¶çš„å¤„ç†ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°å¼•å…¥`EventCenter`å‰åçš„äº‹ä»¶æŒ‚è½½æ–¹å¼ã€‚

å·¦ä¾§ä¿®æ”¹å‰æ˜¯åœ¨æ¸²æŸ“å™¨å®ä¾‹çš„loadæ–¹æ³•ä¸­ä¼ å…¥externalFunctionå¯¹è±¡ã€‚

å³ä¾§ä¿®æ”¹åæ˜¯å–æ¶ˆäº†loadå‡½æ•°ï¼Œç”±å®ä¾‹.onç›‘å¬çš„æ–¹å¼æŒ‚è½½äº‹ä»¶ã€‚

ä»è¿™æ®µä»£ç ç‰‡æ®µé‡Œå¤§å®¶èƒ½çœ‹å‡ºæ¥ï¼Œè¿™æ ·ä¿®æ”¹åä¼šå¸¦æ¥å“ªäº›å¥½å¤„å—ï¼Ÿ
-->

---

### äº‹ä»¶ä¸­å¿ƒ - EventCenter

*Why?*

- è®©ä»£ç æ›´åŠ ç®€æ´å’Œæ¨¡å—åŒ–
- æ•°æ®ä¸äº‹ä»¶æ‹†åˆ†ï¼Œé€»è¾‘æ›´æ¸…æ™°
- å¯ä»¥å°† `Graph` ç±»çš„å®ç°ä¸å…·ä½“çš„å¤–éƒ¨å‡½æ•°è§£è€¦ï¼Œä»è€Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§
- ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨å¯ä»¥å®ç°æ›´åŠ çµæ´»å’Œå¯æ‰©å±•çš„æ¨¡å¼ï¼Œå¯ä»¥åŠ¨æ€åœ°æ·»åŠ æˆ–åˆ é™¤äº‹ä»¶ç›‘å¬å™¨
  - æä¾›ï¼š`on`ã€ `once`ã€ `off`ã€ `emit` å‡½æ•°
- å¯ä»¥é‡å¤æŒ‚è½½

<!-- <p class="remark">
ä¸è¦å°çœ‹é‡å¤æŒ‚è½½å¸¦æ¥çš„å¥½å¤„ã€‚ä¾‹å¦‚ï¼š

- å‰é¢æåˆ°çš„ `DataHandler` å°±æ˜¯ä¾æ‰˜äº `EventCenter` çš„é‡å¤æŒ‚è½½å®ç°çš„ã€‚
  <div class="remark">
  æ¸²æŸ“å™¨å†…éƒ¨çš„ `dataHandler` ä¼šé¦–å…ˆç›‘å¬åˆ°æ•°æ®æ›´æ–°é€šçŸ¥ï¼Œè¿™ä¸€å±‚å†…éƒ¨å¤„ç†å¥½æ•°æ®ï¼Œå¤–éƒ¨ç›‘å¬æ‹¿åˆ°çš„å°±æ˜¯ç»è¿‡ `dataHandler` å¤„ç†çš„æœ€æ–°æ•°æ®ã€‚
  </div>
</p> -->

<!--
#### ä¸è¦å°çœ‹é‡å¤æŒ‚è½½å¸¦æ¥çš„å¥½å¤„ã€‚ä¾‹å¦‚ï¼š

- å‰é¢æåˆ°çš„ `DataHandler` å°±æ˜¯ä¾æ‰˜äº `EventCenter` çš„é‡å¤æŒ‚è½½å®ç°çš„ã€‚

  æ¸²æŸ“å™¨å†…éƒ¨çš„ `dataHandler` ä¼šé¦–å…ˆç›‘å¬åˆ°æ•°æ®æ›´æ–°é€šçŸ¥ï¼Œè¿™ä¸€å±‚å†…éƒ¨å¤„ç†å¥½æ•°æ®ï¼Œå¤–éƒ¨ç›‘å¬æ‹¿åˆ°çš„å°±æ˜¯ç»è¿‡ `dataHandler` å¤„ç†çš„æœ€æ–°æ•°æ®ã€‚

#### æ¥ä¸‹æ¥ä»”ç»†çœ‹ä¸€ä¸‹ `emit` æ–¹æ³•ã€‚

åœ¨ä¸Šä¸€é¡µçš„PPTä¸­ï¼Œæœ‰ä¸€ç§åœºæ™¯æ˜¯æ”¹é€ å‰å¯ç”¨ï¼Œæ”¹é€ ååè€Œæ²¡åŠæ³•é€‚ç”¨äº†ã€‚

è¿™ä¸ªåœºæ™¯æ˜¯ï¼šé€šè¿‡`externals`å¯¹è±¡ä¼ å…¥çš„é’©å­æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤æœ‰ä¸€ä¸ªç¡®å®šçš„è¿”å›å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä¾‹å¦‚ï¼šaddNodeå‡½æ•°é‡Œ`return false`ä½¿æµç¨‹abortï¼ˆç»ˆæ­¢ï¼‰æ‰§è¡Œã€‚

ä½†æ˜¯æ”¹é€ åç”±äºä½¿ç”¨`on`ç›‘å¬å¯ä»¥æŒ‚è½½å¤šä¸ªå‡½æ•°ï¼Œè¿™æ—¶çš„è¿”å›å€¼å°±å˜å¾—ä¸å†å”¯ä¸€ç¡®å®šï¼Œå› è€Œå˜çš„æ— æ³•åˆ©ç”¨ï¼Œå¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿ

å¤§å®¶æœ‰ä»€ä¹ˆæƒ³æ³•å—ï¼Ÿ

ä¸‹ä¸€ç« èŠ‚ä¼šè®²åˆ°ä»£ç å®ç°ã€‚
-->

---
layout: image-right
image: https://zhongxuyang.github.io/blog/assets/DSCF4089.81ad99e7.jpg
---

# 3 **åŠŸèƒ½å®ç°**

<!--
è®¾è®¡ç¼ºé™·éƒ¨åˆ†åˆ°è¿™é‡Œå°±ç»“æŸäº†ã€‚
åœ¨ç¬¬ä¸€æ¬¡çš„å¼€å‘è¿‡ç¨‹ä¸­å…¶å®æ˜¯éš¾ä»¥ç…§é¡¾åˆ°å¾ˆå¤šç»†èŠ‚ï¼Œæˆ–è€…è¯´ä¸€ä¸‹å°±æƒ³åˆ°æœ€ä¼˜è§£çš„ã€‚åœ¨åŠŸèƒ½è¶ŠåŠ è¶Šå¤šã€ä»£ç è¶Šæ¥è¶Šå†—æ‚ä¹‹åï¼Œé‡æ–°å›é¡¾å’Œä¼˜åŒ–ä»£ç ï¼Œä¹Ÿæ˜¯é‡æ–°å­¦ä¹ çš„ã€ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„è¿‡ç¨‹ã€‚

æ¥ä¸‹æ¥æ˜¯åŠŸèƒ½å®ç°éƒ¨åˆ†ã€‚

è¿™é‡Œä»‹ç»3ä¸ªéƒ¨åˆ†ï¼š
- å‰é¢æåˆ°çš„EventCenterä¸­å¦‚ä½•æ ¹æ®å¤–éƒ¨è¿”å›å€¼å†³å®šä¸‹ä¸€æ­¥æ“ä½œ
- æ¸²æŸ“å™¨çš„æ’¤é”€å›é€€çš„å®ç°
- æ–‡æ¡£å¦‚ä½•ç»´æŠ¤
-->

---

### EventCenter

<br/>

<div style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 10px;">
  <div>
    <i>Define</i>
<v-click>

</v-click>

```ts {1,3,5,13,15,16,19}
class EventCenter {
  // ...
  public emit(eventName: Event, ...options) {
    // ...
    const results = []
    for (
      let i = 0, len = listenersForEvent.length; 
      i < len; 
      i++
    ) {
      const result = 
        listenersForEvent[i].call(this, ...options)
      results.push(result)
    }
    // return this
    return results
  }
}
```
  </div>

  <div>
  <i>Usage</i>

```ts
// è§¦å‘
const beforeChangeResult = this.emit(Event.BeforeChange, target)

Promise.all(beforeChangeResult).then(() => {
  // do something...

  this.emit(Event.Change, target)
}).catch(() => {
  // abort
})
```

```ts
// ç›‘å¬
graph.on(Event.BeforeChange, (target) => {
  // ...
  
  // è¿”å›rejectï¼Œç”±ä½¿ç”¨è€…æ¥ç®¡åˆ›å»ºæµç¨‹ï¼ˆå¯åœ¨æ­¤å¤„å¼€å§‹æœåŠ¡ç«¯åˆ›å»ºï¼‰
  return Promise.reject()
})
```
  </div>
</div>

<!--
æ¥ä¸‹æ¥çœ‹å¦‚ä½•å¤„ç†è¿™ç§æƒ…æ™¯ã€‚

æœ€åˆ`EventCenter`çš„`emit`å‡½æ•°è¿”å›çš„æ˜¯å®ƒæœ¬èº«å³thisï¼ˆæ–¹ä¾¿é“¾å¼è°ƒç”¨ï¼‰ï¼Œä½†ç”±äºæœ‰äº†å‰é¢æåˆ°çš„éœ€æ±‚ï¼ŒåŠŸèƒ½æ˜¾ç„¶æ¯”æ–¹ä¾¿æ›´é‡è¦ã€‚

åœ¨Defineä»£ç é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆåœ¨`EventCenter`çš„`emit`äº‹ä»¶é‡Œæ”¶é›†äº†æ‰€æœ‰ç›‘å¬å‡½æ•°çš„è¿”å›å€¼å­˜åˆ°resultsæ•°ç»„ï¼Œæœ€ååœ¨emitå‡½æ•°é‡ŒreturnæŠ›å‡ºå»ã€‚

å¤–éƒ¨æ¥æ”¶resultsåä½¿ç”¨ Promise.all ç¡®ä¿æ˜¯å¦æ‰€æœ‰ç›‘å¬å‡½æ•°ï¼ˆå¯èƒ½ä¼šæœ‰å¼‚æ­¥ï¼‰æ‰§è¡Œå®Œæ¯•ã€‚å¦‚æœåœ¨ç›‘å¬å‡½æ•°return rejectï¼Œæˆ‘ä»¬åˆ™è®¤ä¸ºè¿™ä¸ªæµç¨‹æ— æ³•é€šè¿‡ï¼Œä¹Ÿå°±æ˜¯åœæ­¢åç»­æ“ä½œã€‚

ç”±æ­¤å°±å®ç°äº†å‰é¢æåˆ°çš„åŠŸèƒ½ï¼šè®©ä½¿ç”¨è€…å¼‚æ­¥/å¯é€‰æ‹©çš„å†³å®šæ˜¯å¦ç»§ç»­æ“ä½œã€‚
-->

---

### Plugins - History

<br />

<div style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 10px;">
  <div>

```ts {1,7,9-18,20}
class History {
  private history: Action[]
  private currentIndex: number
  private maxSteps = 20
  private compressTime = 20

  public push(action: Action | Action['reverse']) {
    // ...
    const prevAction = this.history[this.currentIndex]
    if (this.canMerge(prevAction, action)) {
      const cachePrevReverse = prevAction.reverse
      prevAction.reverse = () => {
        ;(action as Action).reverse()
        cachePrevReverse()
      }
      prevAction.time = action.time
      return this
    }
    // ...
  }
```
  </div>

  <div>

```ts {1-4,13-15}
  private canMerge(
    prevAction: Action, 
    nextAction: Action,
  ) {
    const timeDistance = 
      Number(nextAction.time) - Number(prevAction.time)
    const ifTimeLegal = 
      timeDistance <= this.compressTime
    const ifSameTarget = 
      prevAction.targetId === nextAction.targetId
    const ifSameOperation =
      prevAction.operationType === nextAction.operationType
    return 
      ifTimeLegal && ifSameTarget && ifSameOperation
  }

  // ...
}
```
  </div>
</div>

<!--
Historyæ˜¯å®ç°å†å²è®°å½•ç±»ï¼Œä¸»è¦å®ç°æ’¤é”€ã€å›é€€åŠŸèƒ½ã€‚

ä»ä»£ç é‡Œå¯ä»¥çœ‹å‡ºä¸€å…±æœ‰4ä¸ªçŠ¶æ€ï¼š
- historyæ•°ç»„ç”¨äºç¼“å­˜æ¯ä¸€æ­¥æ“ä½œï¼ŒåŒ…å«æ¯ä¸€æ­¥çš„ï¼šæ“ä½œå†…å®¹ã€æ“ä½œäººã€äº‹ä»¶æˆ³ã€‚
- currentIndexç”¨äºæŒ‡ç¤ºå½“å‰å…‰æ ‡ä½ç½®ï¼Œè§¦å‘æ’¤é”€å’Œå›é€€æ—¶ç§»åŠ¨æ­¤æŒ‡é’ˆã€‚
- maxStepsç”¨äºé…ç½®æœ€å¤§ç¼“å­˜æ­¥æ•°ã€‚
- compressTimeç”¨äºé…ç½®å¯å‹ç¼©æ—¶é—´ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€æ­¥æ“ä½œå…¥æ ˆå‰ä¼šæ ¹æ®äº‹ä»¶æˆ³ä¸ä¸Šä¸€æ­¥æ“ä½œçš„æ—¶é—´æˆ³åŒ¹é…ï¼Œå¦‚æœæ—¶é—´å·®å°äºcompressTimeï¼Œé‚£ä¹ˆä¼šæŠŠè¿™ä¸¤æ­¥åˆå¹¶ä¸ºä¸€æ­¥æ“ä½œã€‚

// å¼€å§‹è¿‡ä»£ç 

è§£é‡Šä¸‹ä¸ºä»€ä¹ˆè¿™é‡Œå­˜å‚¨çš„æ˜¯reverseï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ•°æ®ï¼š
 *  åœ¨ç”»å¸ƒä¸­ä¸€æ­¥æ“ä½œä¸€èˆ¬ä¼šå½±å“å¤šä¸ªç›¸å…³çš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šèŠ‚ç‚¹åæ ‡çš„æ”¹å˜ä¼šåŒæ­¥ä¿®æ”¹æ‰€æœ‰ä¸ä¹‹ç›¸å…³çš„è¿çº¿ã€‚
 *  ä¸ºäº†é¿å…è¿™ç§å…³è”æ€§å¸¦æ¥çš„æ•°æ®ä¿®æ”¹å¤æ‚æ€§ï¼Œä¸å¦‚ç›´æ¥ç¼“å­˜é€†å‘æ‰§è¡Œçš„å‡½æ•°ï¼Œé¿å…äº†å¤„ç†ç›¸å…³æ•°æ®çš„ç¹çã€‚
-->

---

### æ–‡æ¡£ç”Ÿæˆ

*ä½¿ç”¨ `typedoc` : [https://typedoc.org/](https://typedoc.org/)*

<br/>

- ä¸ºä»€ä¹ˆæåˆ°è¿™ä¸ªï¼Ÿ
- ä½¿ç”¨ Typescript è¿˜éœ€è¦æ–‡æ¡£å—ï¼Ÿ

<!-- <div style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 10px;">
  <div>
    <i>ä¸ºä»€ä¹ˆæåˆ°è¿™ä¸ªï¼Ÿ</i>
    <p class="remark">
      æ–‡æ¡£ç»´æŠ¤æ˜¯ä¸ªå¾ˆå¤´ç–¼çš„äº‹æƒ…ã€‚
      <br/>
      å¾ˆå¤šæ—¶å€™ä¸€äº›ç»†ç¢çš„ä¿®æ”¹å¾ˆå¯èƒ½å¿˜è®°æ›´æ–°æ–‡æ¡£ï¼Œä¹…è€Œä¹…ä¹‹æ–‡æ¡£å°±å˜å¾—å’ŒçœŸå®ç¨‹åºå·®å¼‚å·¨å¤§ã€‚
      <br/>
      è€Œå½“ç¨‹åºå¤§è§„æ¨¡çš„é‡æ„æ—¶ï¼Œé‡å†™æ–‡æ¡£å°±æ›´æ˜¯å·¨å¤§çš„å·¥ä½œé‡ï¼Œè®©äººæœ›è€Œå´æ­¥ã€‚
    </p>
  </div>

  <div>
    <i>ä½¿ç”¨ Typescript è¿˜éœ€è¦æ–‡æ¡£å—ï¼Ÿ</i>
    <p class="remark">
      è™½ç„¶ `typedoc` æ˜¯åŸºäº `TypeScript` ç±»å‹åŠå¤‡æ³¨å†…å®¹ç”Ÿæˆçš„æ–‡æ¡£ã€‚ä½†ä½¿ç”¨ `TypeScript` ä¸æ„å‘³ç€ä¸éœ€è¦æ–‡æ¡£ã€‚ 
      <br/>
      `typedoc` å¯ä»¥è‡ªåŠ¨ä¸º `TS` ä»£ç ç”Ÿæˆæ˜“è¯»çš„APIæ–‡æ¡£ï¼Œæ–¹ä¾¿å…¶ä»–å¼€å‘è€… `quick start` å’Œç†è§£ä»£ç ã€‚
      <br/>
      é™¤äº†ç”Ÿæˆ `.md` æ–¹ä¾¿åœ¨ `github/npm` ä¸­é¢„è§ˆå¤–ï¼Œç”Ÿæˆçš„é¡µé¢ä¹Ÿä¼šæ›´åŠ æ–¹ä¾¿æœç´¢ã€‚
    </p>
  </div>
</div> -->

<!--
- ä¸ºä»€ä¹ˆæåˆ°è¿™ä¸ªï¼Ÿ

æ–‡æ¡£ç»´æŠ¤æ˜¯ä¸ªå¾ˆå¤´ç–¼çš„äº‹æƒ…ã€‚

å¾ˆå¤šæ—¶å€™ä¸€äº›ç»†ç¢çš„ä¿®æ”¹å¾ˆå¯èƒ½å¿˜è®°æ›´æ–°æ–‡æ¡£ï¼Œä¹…è€Œä¹…ä¹‹æ–‡æ¡£å°±å˜å¾—å’ŒçœŸå®ç¨‹åºå·®å¼‚å·¨å¤§ã€‚

è€Œå½“ç¨‹åºå¤§è§„æ¨¡çš„é‡æ„æ—¶ï¼Œé‡å†™æ–‡æ¡£å°±æ›´æ˜¯å·¨å¤§çš„å·¥ä½œé‡ï¼Œè®©äººæœ›è€Œå´æ­¥ã€‚

è¿™æ—¶å€™è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº†ï¼Œå¯ä»¥åœ¨æ¯æ¬¡å‘ç‰ˆ/é€šè¿‡commit hooksé…ç½®è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ã€‚

- ä½¿ç”¨ Typescript è¿˜éœ€è¦æ–‡æ¡£å—ï¼Ÿ

è™½ç„¶typedocæ˜¯åŸºäºTypeScriptç±»å‹åŠå¤‡æ³¨å†…å®¹ç”Ÿæˆçš„æ–‡æ¡£ã€‚ä½†ä½¿ç”¨TypeScriptä¸æ„å‘³ç€ä¸éœ€è¦æ–‡æ¡£ã€‚ 

typedocå¯ä»¥è‡ªåŠ¨ä¸ºTSä»£ç ç”Ÿæˆæ˜“è¯»çš„APIæ–‡æ¡£ï¼Œæœ‰å“ªäº›åŠŸèƒ½é€šè¿‡æ–‡æ¡£ç›®å½•å°±å¯ä»¥æ–¹ä¾¿çš„çŸ¥é“ï¼Œä¹Ÿæ–¹ä¾¿å…¶ä»–å¼€å‘è€…quick startå’Œç†è§£ä»£ç ã€‚

- ç”Ÿæˆçš„.markdownæ–‡æ¡£å¯ä»¥ä¾¿äºåœ¨github/npmä¸­é¢„è§ˆã€‚
- ç”Ÿæˆçš„htmlé¡µé¢ä¹Ÿä¼šæ›´åŠ æ–¹ä¾¿é¢„è§ˆå’Œæœç´¢æŸ¥æ‰¾ã€‚

// çœ‹ä¸€ä¸‹ç”Ÿæˆæ–‡æ¡£çš„æ ·å­
-->

---

<div class="center">
  
  ## Thanks

  <p class="remark">
  
  [Documentations](https://sli.dev) Â· [GitHub](https://github.com/ZhongxuYang) Â· [Code](https://gitlab.jinxin.dev/ej-dr/infrastructure/infra_front/ej-erg-renderer)
  
  </p>

</div>

<!--
ä»Šå¤©åˆ†äº«çš„å†…å®¹å°±ç»“æŸäº†ã€‚å¤§å®¶æœ‰ä»€ä¹ˆé—®é¢˜æƒ³é—®å—ï¼Ÿ

è¿™æ¬¡åˆ†äº«å†…å®¹ä½¿ç”¨Anthony fuçš„slidev /sli'dÃ¦v/åˆ¶ä½œï¼Œå¾ˆç®€å•ï¼Œå†™markdownæ–‡ä»¶å°±å¥½ï¼Œæœ‰éœ€è¦çš„å¯ä»¥å°è¯•ä¸‹ã€‚
-->